# ============================================
# Fix HTTP 406 Not Acceptable Error - /pawel/ only
# ============================================

# TEST: Verify .htaccess is being applied
<IfModule mod_headers.c>
    Header set X-DX-HTACCESS "pawel-on"
</IfModule>

# CRITICAL: Disable content negotiation BEFORE any other processing
# This must be at the top to prevent Apache from rejecting requests
Options -MultiViews

# Force content type for directory index
DirectoryIndex index.html
<Files index.html>
    ForceType text/html
</Files>

# Force HTML content type for all files
<FilesMatch ".*">
    ForceType text/html
</FilesMatch>

# Remove ModSecurity rules that block based on headers
<IfModule mod_security.c>
    # OWASP CRS rules that cause 406 for programmatic clients
    SecRuleRemoveById 900015
    SecRuleRemoveById 900016
    SecRuleRemoveById 960015
    SecRuleRemoveById 960017
    SecRuleRemoveById 960024
    
    # OWASP CRS 920 series - Protocol Enforcement
    SecRuleRemoveById 920100
    SecRuleRemoveById 920120
    SecRuleRemoveById 920160
    SecRuleRemoveById 920170
    SecRuleRemoveById 920180
    SecRuleRemoveById 920200
    SecRuleRemoveById 920230
    SecRuleRemoveById 920270
    SecRuleRemoveById 920280
</IfModule>

# Alternative: Use RewriteRule to force content type before negotiation
<IfModule mod_rewrite.c>
    RewriteEngine On
    # Force content type before Apache processes the request
    RewriteCond %{REQUEST_URI} ^/pawel/?$ [OR]
    RewriteCond %{REQUEST_URI} ^/pawel/index\.html?$
    RewriteRule .* - [T=text/html]
</IfModule>
